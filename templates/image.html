<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yaratıcı Görsel Üretici</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
        }
        .gradient-text {
            background: linear-gradient(90deg, #ff6b6b, #ffa1a1, #ffc6c6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .btn-gradient {
            background: linear-gradient(90deg, #ff6b6b, #ffc6c6);
            transition: all 0.3s ease;
        }
        .btn-gradient:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
        }
        /* Prompt kartı seçildiğinde pulsating efekti */
        .selected-card {
            animation: pulse-border 2s infinite;
        }
        
        @keyframes pulse-border {
            0% {
                border-color: rgba(139, 92, 246, 0.3);
            }
            50% {
                border-color: rgba(139, 92, 246, 0.8);
            }
            100% {
                border-color: rgba(139, 92, 246, 0.3);
            }
        }
        /* Gradient overlay için nefes alma animasyonu */
        .breathing-gradient {
            animation: breathing-gradient 3s ease-in-out infinite;
        }
        
        @keyframes breathing-gradient {
            0% {
                opacity: 0.3;
            }
            50% {
                opacity: 0.7;
            }
            100% {
                opacity: 0.3;
            }
        }
        /* Aspect ratio seçimi için stil */
        .aspect-ratio-option {
            transition: all 0.3s ease;
            position: relative;
        }
        .aspect-ratio-option.selected {
            transform: translateY(-3px);
        }
        .aspect-ratio-option.selected::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border-radius: 0.5rem;
            background: linear-gradient(90deg, #8b5cf6, #ec4899);
            z-index: -1;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% {
                opacity: 0.6;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0.6;
            }
        }
        /* Görsel galerisi için stil */
        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }
        .image-item {
            position: relative;
            overflow: hidden;
            border-radius: 0.5rem;
            transition: transform 0.3s ease;
        }
        .image-item:hover {
            transform: translateY(-5px);
        }
        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.3s ease;
        }
        .image-item:hover img {
            opacity: 0.9;
        }
        
        /* Modern yükleme animasyonları */
        .loader-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        /* Prompt yükleme animasyonu */
        .prompt-loader {
            width: 80px;
            height: 80px;
            position: relative;
            margin-bottom: 1.5rem;
        }
        .prompt-loader div {
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(90deg, #8b5cf6, #ec4899);
            animation: prompt-loader 1.2s linear infinite;
        }
        .prompt-loader div:nth-child(1) {
            top: 8px;
            left: 8px;
            animation-delay: 0s;
        }
        .prompt-loader div:nth-child(2) {
            top: 8px;
            left: 32px;
            animation-delay: -0.4s;
        }
        .prompt-loader div:nth-child(3) {
            top: 8px;
            left: 56px;
            animation-delay: -0.8s;
        }
        .prompt-loader div:nth-child(4) {
            top: 32px;
            left: 8px;
            animation-delay: -0.4s;
        }
        .prompt-loader div:nth-child(5) {
            top: 32px;
            left: 32px;
            animation-delay: -0.8s;
        }
        .prompt-loader div:nth-child(6) {
            top: 32px;
            left: 56px;
            animation-delay: -1.2s;
        }
        .prompt-loader div:nth-child(7) {
            top: 56px;
            left: 8px;
            animation-delay: -0.8s;
        }
        .prompt-loader div:nth-child(8) {
            top: 56px;
            left: 32px;
            animation-delay: -1.2s;
        }
        .prompt-loader div:nth-child(9) {
            top: 56px;
            left: 56px;
            animation-delay: -1.6s;
        }
        @keyframes prompt-loader {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.5;
                transform: scale(0.8);
            }
        }
        
        /* Görsel yükleme animasyonu */
        .image-loader {
            width: 100px;
            height: 100px;
            position: relative;
            margin-bottom: 1.5rem;
        }
        .image-loader:before, .image-loader:after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid transparent;
        }
        .image-loader:before {
            border-top-color: #8b5cf6;
            border-right-color: #ec4899;
            animation: spin 1.5s linear infinite;
        }
        .image-loader:after {
            border-bottom-color: #8b5cf6;
            border-left-color: #ec4899;
            animation: spin 1s ease-in-out infinite reverse;
        }
        @keyframes spin {
            0% {
                transform: rotate(0deg) scale(1);
            }
            50% {
                transform: rotate(180deg) scale(1.1);
            }
            100% {
                transform: rotate(360deg) scale(1);
            }
        }
        
        /* Yükleme metni animasyonu */
        .loading-text {
            font-weight: 500;
            background: linear-gradient(90deg, #8b5cf6, #ec4899, #8b5cf6);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: shine 2s linear infinite;
        }
        @keyframes shine {
            to {
                background-position: 200% center;
            }
        }
    </style>
</head>
<body class="text-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="flex items-center mb-6">
            <a href="{{ url_for('welcome') }}" class="text-white text-sm hover:underline flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
                Ana Sayfa
            </a>
        </div>

        <header class="mb-12 text-center">
            <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-500 to-pink-500 mb-2">Yaratıcı Görsel Üretici</h1>
            <p class="text-gray-400 max-w-2xl mx-auto">İşte sizin için oluşturduğumuz görseller!</p>
        </header>

        <div class="max-w-6xl mx-auto bg-gray-800 rounded-xl shadow-2xl overflow-hidden">
            <div class="p-6">
                <div id="imageResult" class="mt-8">
                    <h2 class="text-xl font-semibold mb-4 text-purple-400">Oluşturulan Görseller</h2>
                    
                    <!-- Görsel Galerisi -->
                    <div class="bg-gray-900 p-4 rounded-lg">
                        {% if image_urls and image_urls|length > 0 %}
                        <div class="image-gallery">
                            {% for image_url in image_urls %}
                            <div class="image-item">
                                <a href="{{ image_url }}" target="_blank" class="block">
                                    <img src="{{ image_url }}" alt="Oluşturulan Görsel {{ loop.index }}" class="rounded-lg shadow-lg hover:opacity-90 transition-opacity cursor-zoom-in" title="Tam boyutta görmek için tıklayın">
                                </a>
                                <div class="mt-2 flex justify-center">
                                    <a href="{{ image_url }}" target="_blank" class="text-sm py-2 px-4 bg-blue-600 text-white font-medium rounded-lg transition duration-300 flex items-center hover:bg-blue-700">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                        </svg>
                                        Görseli Aç ve Kaydet
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        
                        <!-- Tüm görselleri indirme butonu kaldırıldı -->
                        {% else %}
                        <div class="text-center py-8">
                            <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-purple-500 mb-4"></div>
                            <p class="text-gray-300">Görseller yükleniyor veya henüz oluşturulmadı...</p>
                            <p class="text-gray-400 mt-2">Lütfen bekleyin veya yeni bir görsel oluşturun.</p>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="mt-4">
                        <h3 class="text-lg font-medium text-gray-300 mb-2">Kullanılan Prompt:</h3>
                        <p id="usedPrompt" class="text-gray-400 bg-gray-700 p-3 rounded-lg">{{ prompt }}</p>
                    </div>
                    <div class="mt-4">
                        <h3 class="text-lg font-medium text-gray-300 mb-2">Marka Bilgisi:</h3>
                        <p id="brandInfo" class="text-gray-400 bg-gray-700 p-3 rounded-lg">{{ brand }}</p>
                    </div>
                    <div class="mt-4">
                        <h3 class="text-lg font-medium text-gray-300 mb-2">Kullanılan Ölçü Oranı:</h3>
                        <p id="usedAspectRatio" class="text-gray-400 bg-gray-700 p-3 rounded-lg">{{ aspect_ratio }}</p>
                    </div>
                    <div class="mt-6 text-center">
                        <a href="{{ url_for('image') }}" class="inline-block py-3 px-6 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-medium rounded-lg shadow-lg hover:from-purple-700 hover:to-pink-700 transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50">
                            Yeni Görsel Oluştur
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <footer class="mt-12 text-center text-gray-500 text-sm">
            <p>© 2025 Yaratıcı Görsel Üretici | AI Destekli Görsel Üretim Aracı</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Görsellerin yüklenmesini kontrol et
            const images = document.querySelectorAll('.image-gallery img');
            images.forEach(img => {
                img.addEventListener('error', function() {
                    this.parentNode.innerHTML = `
                        <div class="flex items-center justify-center h-48 bg-gray-800 rounded-lg">
                            <p class="text-red-400 text-sm">Görsel yüklenemedi</p>
                        </div>
                    `;
                });
            });
            
            // İndirme fonksiyonları kaldırıldı
            
            // URL parametrelerini kontrol et
            const urlParams = new URLSearchParams(window.location.search);
            const promptId = urlParams.get('prompt_id');
            const imageUrl = urlParams.get('image_url');
            const imageUrls = urlParams.getAll('image_url');
            
            // Görselleri görüntülemek için fonksiyon
            function displayImages(imageUrls, prompt, brandInput, aspectRatio) {
                // Yükleme animasyonunu gizle
                const loaderContainer = document.querySelector('#imageResult .text-center.py-8');
                if (loaderContainer) {
                    loaderContainer.classList.add('hidden');
                }
                
                // Prompt ve brand bilgilerini güncelle
                const promptElement = document.getElementById('usedPrompt');
                const brandElement = document.getElementById('brandInfo');
                const aspectRatioElement = document.getElementById('usedAspectRatio');
                
                if (promptElement) {
                    promptElement.textContent = prompt;
                }
                
                if (brandElement) {
                    brandElement.textContent = brandInput;
                }
                
                if (aspectRatioElement) {
                    aspectRatioElement.textContent = aspectRatio;
                }
                
                // Görsel galerisini tekrar seç (oluşturulmuş olabilir)
                const gallery = document.querySelector('.image-gallery');
                if (gallery) {
                    // Görselleri ekle
                    gallery.innerHTML = '';
                    imageUrls.forEach((url, index) => {
                        const imageItem = document.createElement('div');
                        imageItem.className = 'image-item';
                        imageItem.innerHTML = `
                            <a href="${url}" target="_blank" class="block">
                                <img src="${url}" alt="Oluşturulan Görsel ${index + 1}" class="rounded-lg shadow-lg hover:opacity-90 transition-opacity cursor-zoom-in" title="Tam boyutta görmek için tıklayın">
                            </a>
                            <div class="mt-2 flex justify-center">
                                <a href="${url}" target="_blank" class="text-sm py-2 px-4 bg-blue-600 text-white font-medium rounded-lg transition duration-300 flex items-center hover:bg-blue-700">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                    </svg>
                                    Görseli Aç ve Kaydet
                                </a>
                            </div>
                        `;
                        gallery.appendChild(imageItem);
                    });
                    
                    // Görsellerin yüklenmesini kontrol et
                    const images = gallery.querySelectorAll('img');
                    images.forEach(img => {
                        img.addEventListener('error', function() {
                            this.parentNode.innerHTML = `
                                <div class="flex items-center justify-center h-48 bg-gray-800 rounded-lg">
                                    <p class="text-red-400 text-sm">Görsel yüklenemedi</p>
                                </div>
                            `;
                        });
                    });
                } else {
                    // Eğer galeri yoksa, yükleme animasyonunu gizle ve galeri oluştur
                    const galleryContainer = document.querySelector('#imageResult .bg-gray-900.p-4.rounded-lg');
                    if (galleryContainer) {
                        // Yükleme animasyonunu gizle
                        const loaderContainer = galleryContainer.querySelector('.text-center.py-8');
                        if (loaderContainer) {
                            loaderContainer.classList.add('hidden');
                        }
                        
                        // Galeri oluştur
                        const newGallery = document.createElement('div');
                        newGallery.className = 'image-gallery';
                        galleryContainer.appendChild(newGallery);
                        
                        // Görselleri ekle
                        imageUrls.forEach((url, index) => {
                            const imageItem = document.createElement('div');
                            imageItem.className = 'image-item';
                            imageItem.innerHTML = `
                                <a href="${url}" target="_blank" class="block">
                                    <img src="${url}" alt="Oluşturulan Görsel ${index + 1}" class="rounded-lg shadow-lg hover:opacity-90 transition-opacity cursor-zoom-in" title="Tam boyutta görmek için tıklayın">
                                </a>
                                <div class="mt-2 flex justify-center">
                                    <a href="${url}" target="_blank" class="text-sm py-2 px-4 bg-blue-600 text-white font-medium rounded-lg transition duration-300 flex items-center hover:bg-blue-700">
                                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                        </svg>
                                        Görseli Aç ve Kaydet
                                    </a>
                                </div>
                            `;
                            newGallery.appendChild(imageItem);
                        });
                    }
                }
            }
            
            // Görsel durumunu kontrol eden ve gösteren fonksiyon
            function checkImageStatusAndDisplay(promptId, prompt, brand) {
                // Görsel sonuç alanını göster - bu yeterli olacak
                imageResult.classList.remove('hidden');
                
                // Seçilen aspect ratio değerini al
                const aspectRatio = document.querySelector('input[name="aspectRatio"]:checked').value;
                
                // Durum kontrolü için fonksiyon
                function checkStatus() {
                    fetch(`/check_image_status/${promptId}?aspect_ratio=${aspectRatio}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.is_ready && data.image_urls && data.image_urls.length > 0) {
                                // Görseller hazırsa, sayfayı yenilemeden görselleri göster
                                displayImages(data.image_urls, data.prompt || prompt, data.brand || brand, data.aspect_ratio || aspectRatio);
                                
                                // Kontrol döngüsünü durdur
                                clearInterval(statusInterval);
                                
                                // Butonu sıfırla
                                resetCreateButton();
                            }
                        })
                        .catch(error => {
                            console.error('Durum kontrolü hatası:', error);
                        });
                }
                
                // İlk kontrolü hemen yap
                checkStatus();
                
                // 5 saniyede bir kontrol et
                const statusInterval = setInterval(checkStatus, 5000);
                
                // 60 saniye sonra kontrolü durdur
                setTimeout(() => {
                    clearInterval(statusInterval);
                    
                    // Eğer hala görseller yüklenmediyse, butonu sıfırla
                    resetCreateButton();
                }, 60000);
            }
            
            // Eğer prompt_id varsa ve görseller yoksa, durumu periyodik olarak kontrol et
            if (promptId && (!imageUrls || imageUrls.length === 0)) {
                checkImageStatusAndDisplay(promptId, urlParams.get('prompt') || '', urlParams.get('brand') || '');
            }
            
            // Eğer image_url parametresi yoksa, form sayfasını göster
            if (!imageUrl && !promptId) {
                // Form sayfası HTML'ini oluştur
                document.querySelector('.container').innerHTML = `
                    <div class="flex items-center mb-6">
                        <a href="{{ url_for('welcome') }}" class="text-white text-sm hover:underline flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                            </svg>
                            Ana Sayfa
                        </a>
                    </div>

                    <header class="mb-12 text-center">
                        <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-500 to-pink-500 mb-2">Yaratıcı Görsel Üretici</h1>
                        <p class="text-gray-400 max-w-2xl mx-auto">AI destekli görseller oluşturun. Oluşturmak istediğiniz görseller için bir prompt girin, promptlar oluşturalım ve harika görseller üretelim.</p>
                    </header>

                    <div class="max-w-3xl mx-auto bg-gray-800 rounded-xl shadow-2xl overflow-hidden">
                        <div class="p-6">
                            <form id="imageForm" class="mb-6">
                                <div class="mb-4">
                                    <label for="brandInput" class="block text-gray-300 mb-2 font-medium"></label>
                                    <textarea id="brandInput" name="brand_input" rows="4" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-100" placeholder="Oluşturmak istediğiniz görseller için bir prompt girin..."></textarea>
                                </div>
                                
                                <button id="generateBtn" type="submit" class="w-full py-3 px-6 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-medium rounded-lg shadow-lg hover:from-purple-700 hover:to-pink-700 transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50">
                                    Görsel Promptları Oluştur
                                </button>
                            </form>

                            <div id="loadingPrompts" class="hidden text-center py-8">
                                <div class="loader-container">
                                    <div class="prompt-loader">
                                        <div></div>
                                        <div></div>
                                        <div></div>
                                        <div></div>
                                        <div></div>
                                        <div></div>
                                        <div></div>
                                        <div></div>
                                        <div></div>
                                    </div>
                                    <p class="loading-text text-xl">Yaratıcı fikirler oluşturuluyor...</p>
                                    <p class="text-gray-400 mt-2">Yapay zeka sizin için en iyi promptları hazırlıyor</p>
                                </div>
                            </div>

                            <div id="promptResults" class="hidden">
                                <h2 class="text-xl font-semibold mb-4 text-purple-400">Oluşturulan Promptlar</h2>
                                <p class="text-gray-400 mb-4">Beğendiğiniz promptu seçin ve görsel oluşturun.</p>
                                
                                <div class="prompt-container grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- Promptlar JavaScript ile buraya eklenecek -->
                                </div>
                                
                                <!-- Görsel Boyutu seçimi promptların altına taşındı -->
                                <div class="mt-6 mb-4">
                                    <label class="block text-gray-300 mb-2 font-medium">Görsel Boyutu</label>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <label class="aspect-ratio-option flex flex-col items-center bg-gray-700 p-4 rounded-lg border border-gray-600 cursor-pointer hover:bg-gray-600 transition-colors selected">
                                            <input type="radio" name="aspectRatio" value="1:1" class="sr-only aspect-ratio-input" checked>
                                            <div class="w-14 h-14 bg-gray-500 rounded-sm mb-2 flex items-center justify-center">
                                                <div class="w-12 h-12 bg-gray-300 rounded-sm"></div>
                                            </div>
                                            <span class="text-gray-300 font-medium">1:1</span>
                                            <span class="text-gray-400 text-xs mt-1">Kare (Instagram, Facebook)</span>
                                        </label>
                                        <label class="aspect-ratio-option flex flex-col items-center bg-gray-700 p-4 rounded-lg border border-gray-600 cursor-pointer hover:bg-gray-600 transition-colors">
                                            <input type="radio" name="aspectRatio" value="4:5" class="sr-only aspect-ratio-input">
                                            <div class="w-12 h-15 bg-gray-500 rounded-sm mb-2 flex items-center justify-center">
                                                <div class="w-10 h-12 bg-gray-300 rounded-sm"></div>
                                            </div>
                                            <span class="text-gray-300 font-medium">4:5</span>
                                            <span class="text-gray-400 text-xs mt-1">Dikey (Instagram Post)</span>
                                        </label>
                                        <label class="aspect-ratio-option flex flex-col items-center bg-gray-700 p-4 rounded-lg border border-gray-600 cursor-pointer hover:bg-gray-600 transition-colors">
                                            <input type="radio" name="aspectRatio" value="16:9" class="sr-only aspect-ratio-input">
                                            <div class="w-16 h-9 bg-gray-500 rounded-sm mb-2 flex items-center justify-center">
                                                <div class="w-14 h-7 bg-gray-300 rounded-sm"></div>
                                            </div>
                                            <span class="text-gray-300 font-medium">16:9</span>
                                            <span class="text-gray-400 text-xs mt-1">Yatay (Web, LinkedIn)</span>
                                        </label>
                                        <label class="aspect-ratio-option flex flex-col items-center bg-gray-700 p-4 rounded-lg border border-gray-600 cursor-pointer hover:bg-gray-600 transition-colors">
                                            <input type="radio" name="aspectRatio" value="9:16" class="sr-only aspect-ratio-input">
                                            <div class="w-12 h-16 bg-gray-500 rounded-sm mb-2 flex items-center justify-center">
                                                <div class="w-8 h-14 bg-gray-300 rounded-sm"></div>
                                            </div>
                                            <span class="text-gray-300 font-medium">9:16</span>
                                            <span class="text-gray-400 text-xs mt-1">Dikey (Instagram Stories)</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <!-- Görsel Oluştur butonu -->
                                <div class="mt-8 text-center">
                                    <button id="createImageBtn" class="py-3 px-8 text-white font-medium rounded-lg shadow-lg transition duration-300 opacity-50 cursor-not-allowed bg-gray-600" disabled>
                                        Görsel Oluştur
                                    </button>
                                    <p class="text-gray-400 text-sm mt-2">Lütfen önce bir prompt seçin</p>
                                </div>
                            </div>

                            <div id="imageLoading" class="hidden text-center py-8">
                                <div class="loader-container">
                                    <div class="image-loader"></div>
                                    <p class="loading-text text-xl">Görsel sanat yaratılıyor...</p>
                                    <p class="text-gray-400 mt-2">Bu işlem birkaç dakika sürebilir. Lütfen bekleyin.</p>
                                </div>
                            </div>
                            
                            <div id="imageResult" class="hidden mt-8">
                                <h2 class="text-xl font-semibold mb-4 text-purple-400">Oluşturulan Görseller</h2>
                                
                                <!-- Görsel Galerisi -->
                                <div class="bg-gray-900 p-4 rounded-lg">
                                    <div class="text-center py-8">
                                        <div class="loader-container">
                                            <div class="image-loader"></div>
                                            <p class="loading-text text-xl">Görsel sanat yaratılıyor...</p>
                                            <p class="text-gray-400 mt-2">Bu işlem birkaç dakika sürebilir. Lütfen bekleyin.</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <h3 class="text-lg font-medium text-gray-300 mb-2">Kullanılan Prompt:</h3>
                                    <p id="usedPrompt" class="text-gray-400 bg-gray-700 p-3 rounded-lg"></p>
                                </div>
                                <div class="mt-4">
                                    <h3 class="text-lg font-medium text-gray-300 mb-2">Marka Bilgisi:</h3>
                                    <p id="brandInfo" class="text-gray-400 bg-gray-700 p-3 rounded-lg"></p>
                                </div>
                                <div class="mt-4">
                                    <h3 class="text-lg font-medium text-gray-300 mb-2">Kullanılan Ölçü Oranı:</h3>
                                    <p id="usedAspectRatio" class="text-gray-400 bg-gray-700 p-3 rounded-lg"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <footer class="mt-12 text-center text-gray-500 text-sm">
                        <p>© 2025 | AI Destekli Görsel Üretim Aracı</p>
                    </footer>
                `;

                // Form ve diğer elementleri seç
                const imageForm = document.getElementById('imageForm');
                const loadingPrompts = document.getElementById('loadingPrompts');
                const promptResults = document.getElementById('promptResults');
                const promptContainer = document.querySelector('.prompt-container');
                const imageLoading = document.getElementById('imageLoading');
                const imageResult = document.getElementById('imageResult');
                
                // Seçilen prompt için global değişken
                let selectedPrompt = null;
                
                // Aspect ratio seçimi için
                const aspectRatioInputs = document.querySelectorAll('.aspect-ratio-input');
                const aspectRatioOptions = document.querySelectorAll('.aspect-ratio-option');
                
                // Sayfa yüklendiğinde varsayılan seçimi işaretle
                updateSelectedAspectRatio();
                
                // Her bir radio input için event listener ekle
                aspectRatioInputs.forEach(input => {
                    input.addEventListener('change', updateSelectedAspectRatio);
                });
                
                // Seçilen aspect ratio'yu güncelle
                function updateSelectedAspectRatio() {
                    aspectRatioOptions.forEach(option => {
                        const input = option.querySelector('input');
                        if (input.checked) {
                            option.classList.add('selected');
                        } else {
                            option.classList.remove('selected');
                        }
                    });
                }
                
                // Form gönderildiğinde
                imageForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const brandInput = document.getElementById('brandInput').value;
                    if (!brandInput) {
                        alert('Lütfen marka/ürün bilgisi girin');
                        return;
                    }
                    
                    // Seçilen aspect ratio değerini al
                    const aspectRatio = document.querySelector('input[name="aspectRatio"]:checked').value;
                    
                    // Eski promptları gizle
                    promptResults.classList.add('hidden');
                    promptContainer.innerHTML = ''; // Eski promptları temizle
                    
                    // Promptları oluşturma işlemi
                    loadingPrompts.classList.remove('hidden');
                    
                    // API'ye istek at
                    fetch('/generate-prompt', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            text: brandInput,
                            feature_type: 'image',
                            aspect_ratio: aspectRatio
                        })
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Prompt oluşturma hatası');
                        }
                        return response.json();
                    })
                    .then(data => {
                        loadingPrompts.classList.add('hidden');
                        promptResults.classList.remove('hidden');
                        
                        // API'den gelen promptları ekrana ekle
                        promptContainer.innerHTML = '';
                        data.prompt_data.forEach((item, index) => {
                            const promptCard = document.createElement('div');
                            promptCard.className = 'bg-gradient-to-br from-gray-700 to-gray-800 p-4 rounded-lg cursor-pointer hover:from-gray-600 hover:to-gray-700 transition-all duration-300 border border-transparent relative overflow-hidden';
                            
                            // Prompt ID'si oluştur
                            const promptId = `prompt-${index}`;
                            const textareaId = `textarea-${index}`;
                            
                            // Prompt kartı içeriği
                            promptCard.innerHTML = `
                                <div class="mb-2">
                                    <h3 class="font-medium text-purple-300 text-center">${item.style}</h3>
                                </div>
                                <div class="prompt-content" id="${promptId}">
                                    <p class="text-gray-300">${item.prompt}</p>
                                </div>
                                <div class="prompt-edit hidden" id="${textareaId}">
                                    <textarea class="w-full bg-gray-800 text-gray-300 p-2 rounded mb-2" rows="5">${item.prompt}</textarea>
                                    <div class="flex justify-center space-x-2">
                                        <button class="cancel-btn bg-gray-600 hover:bg-gray-500 text-white text-xs px-2 py-1 rounded transition-colors" data-index="${index}">
                                            İptal
                                        </button>
                                        <button class="save-btn bg-green-600 hover:bg-green-700 text-white text-xs px-2 py-1 rounded transition-colors" data-index="${index}">
                                            Kaydet
                                        </button>
                                    </div>
                                </div>
                                <div class="mt-3 flex justify-center">
                                    <button class="edit-btn bg-blue-600 hover:bg-blue-700 text-white text-xs px-3 py-1 rounded-full transition-colors" data-index="${index}">
                                        Düzenle
                                    </button>
                                </div>
                                <!-- Check mark icon (initially hidden) -->
                                <div class="absolute top-2 right-2 bg-purple-500 rounded-full p-1 scale-0 transition-transform duration-300 check-mark">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                    </svg>
                                </div>
                                <!-- Gradient overlay for selected card (initially transparent) -->
                                <div class="absolute inset-0 bg-gradient-to-br from-purple-600/0 to-pink-600/0 transition-all duration-500 pointer-events-none gradient-overlay"></div>
                            `;
                            
                            promptContainer.appendChild(promptCard);
                            
                            // Prompt kartına tıklama olayı ekle
                            const promptContent = promptCard.querySelector(`#${promptId}`);
                            promptContent.addEventListener('click', function() {
                                // Seçilen aspect ratio değerini al
                                const currentAspectRatio = document.querySelector('input[name="aspectRatio"]:checked').value;
                                
                                // Tüm prompt kartlarını normal stile döndür
                                const allPromptCards = document.querySelectorAll('.prompt-container > div');
                                allPromptCards.forEach(card => {
                                    // Eski vurgulamaları kaldır
                                    card.classList.remove('ring-2', 'ring-purple-500', 'ring-offset-2', 'ring-offset-gray-800');
                                    card.classList.remove('from-purple-700', 'to-purple-900');
                                    card.classList.add('from-gray-700', 'to-gray-800');
                                    
                                    // Check mark'ı gizle
                                    const checkMark = card.querySelector('.check-mark');
                                    if (checkMark) checkMark.classList.remove('scale-100');
                                    checkMark.classList.add('scale-0');
                                    
                                    // Gradient overlay'i sıfırla
                                    const overlay = card.querySelector('.gradient-overlay');
                                    if (overlay) {
                                        overlay.classList.remove('from-purple-600/50', 'to-pink-600/50', 'breathing-gradient');
                                        overlay.classList.add('from-purple-600/0', 'to-pink-600/0');
                                    }
                                });
                                
                                // Bu kartı vurgula
                                // Check mark'ı göster
                                const checkMark = promptCard.querySelector('.check-mark');
                                if (checkMark) {
                                    checkMark.classList.remove('scale-0');
                                    checkMark.classList.add('scale-100');
                                }
                                
                                // Gradient overlay'i etkinleştir
                                const overlay = promptCard.querySelector('.gradient-overlay');
                                if (overlay) {
                                    overlay.classList.remove('from-purple-600/0', 'to-pink-600/0');
                                    overlay.classList.add('from-purple-600/50', 'to-pink-600/50', 'breathing-gradient');
                                }
                                
                                // Pulsating animasyonu ekle
                                promptCard.classList.add('selected-card');
                                
                                // Seçilen promptu global değişkene kaydet
                                selectedPrompt = item.prompt;
                                
                                // Görsel oluşturma butonunu etkinleştir
                                const createImageBtn = document.getElementById('createImageBtn');
                                if (createImageBtn) {
                                    createImageBtn.disabled = false;
                                    createImageBtn.classList.remove('opacity-50', 'cursor-not-allowed', 'bg-gray-600');
                                    createImageBtn.classList.add('bg-gradient-to-r', 'from-purple-600', 'to-pink-600', 'hover:from-purple-700', 'hover:to-pink-700', 'hover:scale-105');
                                }
                            });
                            
                            // Düzenle butonuna tıklama olayı ekle
                            const editBtn = promptCard.querySelector('.edit-btn');
                            editBtn.addEventListener('click', function(e) {
                                e.stopPropagation(); // Kartın tıklama olayını engelle
                                
                                // Düzenleme modunu aç
                                const promptContent = document.getElementById(promptId);
                                const promptEdit = document.getElementById(textareaId);
                                
                                promptContent.classList.add('hidden');
                                promptEdit.classList.remove('hidden');
                            });
                            
                            // İptal butonuna tıklama olayı ekle
                            const cancelBtn = promptCard.querySelector('.cancel-btn');
                            cancelBtn.addEventListener('click', function(e) {
                                e.stopPropagation(); // Kartın tıklama olayını engelle
                                
                                // Düzenleme modunu kapat
                                const promptContent = document.getElementById(promptId);
                                const promptEdit = document.getElementById(textareaId);
                                
                                promptContent.classList.remove('hidden');
                                promptEdit.classList.add('hidden');
                                
                                // Textarea içeriğini orijinal prompt ile değiştir
                                const textarea = promptEdit.querySelector('textarea');
                                textarea.value = item.prompt;
                            });
                            
                            // Kaydet butonuna tıklama olayı ekle
                            const saveBtn = promptCard.querySelector('.save-btn');
                            saveBtn.addEventListener('click', function(e) {
                                e.stopPropagation(); // Kartın tıklama olayını engelle
                                
                                // Yeni prompt değerini al
                                const textarea = document.querySelector(`#${textareaId} textarea`);
                                const newPrompt = textarea.value.trim();
                                
                                if (newPrompt) {
                                    // Prompt değerini güncelle
                                    item.prompt = newPrompt;
                                    
                                    // Görünümü güncelle
                                    const promptContent = document.getElementById(promptId);
                                    promptContent.querySelector('p').textContent = newPrompt;
                                    
                                    // Düzenleme modunu kapat
                                    promptContent.classList.remove('hidden');
                                    document.getElementById(textareaId).classList.add('hidden');
                                }
                            });
                        });
                        
                        // Aspect ratio seçimini güncelle
                        updateSelectedAspectRatio();
                        
                        // Görsel Oluştur butonuna tıklama olayı ekle
                        const createImageBtn = document.getElementById('createImageBtn');
                        if (createImageBtn) {
                            createImageBtn.addEventListener('click', function() {
                                if (selectedPrompt) {
                                    // Seçilen aspect ratio değerini al
                                    const currentAspectRatio = document.querySelector('input[name="aspectRatio"]:checked').value;
                                    // Görsel oluştur
                                    generateImage(selectedPrompt, brandInput, currentAspectRatio);
                                    
                                    // Butonu devre dışı bırak
                                    this.disabled = true;
                                    this.classList.add('opacity-70', 'cursor-not-allowed');
                                    this.classList.remove('hover:scale-105');
                                    this.innerHTML = `
                                        <span class="inline-flex items-center">
                                            <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                            </svg>
                                            Görsel Oluşturuluyor...
                                        </span>
                                    `;
                                }
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        loadingPrompts.classList.add('hidden');
                        alert('Promptlar oluşturulurken bir hata oluştu. Lütfen tekrar deneyin.');
                    });
                });
                
                // Görsel oluşturma fonksiyonu
                function generateImage(prompt, brandInput, aspectRatio) {
                    // Prompt sonuçlarını gizle yerine görünür bırakıyoruz
                    // promptResults.classList.add('hidden');
                    
                    // Görsel sonuç alanını göster
                    imageResult.classList.remove('hidden');
                    
                    // Prompt ve brand bilgilerini güncelle
                    const promptElement = document.getElementById('usedPrompt');
                    const brandElement = document.getElementById('brandInfo');
                    const aspectRatioElement = document.getElementById('usedAspectRatio');
                    
                    if (promptElement) {
                        promptElement.textContent = prompt;
                    }
                    
                    if (brandElement) {
                        brandElement.textContent = brandInput;
                    }
                    
                    if (aspectRatioElement) {
                        aspectRatioElement.textContent = aspectRatio;
                    }
                    
                    // API'ye istek gönder
                    const formData = new FormData();
                    formData.append('prompt', prompt);
                    formData.append('brand_input', brandInput);
                    formData.append('aspect_ratio', aspectRatio);
                    formData.append('redirect', 'false');
                    
                    fetch('/generate_image', {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Görsel oluşturma hatası: ' + response.status);
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Prompt ID varsa, asenkron işleme için kontrol et
                        if (data.prompt_id) {
                            // Alert mesajını kaldırdık
                            
                            // Görsel durumunu kontrol et
                            checkImageStatusAndDisplay(data.prompt_id, prompt, brandInput);
                        } else if (data.image_urls && data.image_urls.length > 0) {
                            // Görseller hazırsa, sayfayı yenilemeden görselleri göster
                            displayImages(data.image_urls, data.prompt || prompt, data.brand || '', data.aspect_ratio || '');
                            
                            // Butonu sıfırla
                            resetCreateButton();
                        } else if (data.image_url) {
                            // Tek görsel URL'si varsa
                            displayImages([data.image_url], prompt, data.brand || '', data.aspect_ratio || '');
                            
                            // Butonu sıfırla
                            resetCreateButton();
                        } else {
                            // Hata durumu
                            imageLoading.classList.add('hidden');
                            alert('Görsel oluşturulurken bir hata oluştu. Lütfen tekrar deneyin.');
                            
                            // Butonu sıfırla
                            resetCreateButton();
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        imageLoading.classList.add('hidden');
                        alert('Görsel oluşturulurken bir hata oluştu. Lütfen tekrar deneyin.');
                        
                        // Butonu sıfırla
                        resetCreateButton();
                    });
                }

                // Görsel oluşturma butonunu sıfırlama fonksiyonu
                function resetCreateButton() {
                    const createImageBtn = document.getElementById('createImageBtn');
                    if (createImageBtn) {
                        createImageBtn.disabled = false;
                        // Tüm eski sınıfları kaldır
                        createImageBtn.classList.remove('opacity-70', 'cursor-not-allowed');
                        
                        // Gradient sınıflarını ekle (mor-pembe degrade)
                        if (!createImageBtn.classList.contains('bg-gradient-to-r')) {
                            createImageBtn.classList.add('bg-gradient-to-r', 'from-purple-600', 'to-pink-600', 'hover:from-purple-700', 'hover:to-pink-700', 'hover:scale-105');
                        }
                        
                        // Metni sıfırla
                        createImageBtn.innerHTML = 'Görsel Oluştur';
                    }
                }
            }
        });
    </script>
</body>
</html> 