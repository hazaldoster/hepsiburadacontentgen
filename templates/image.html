<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hƒ±zlƒ± G√∂rsel √úretici</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
        }
        .gradient-text {
            background: linear-gradient(90deg, #ff6b6b, #ffa1a1, #ffc6c6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .btn-gradient {
            background: linear-gradient(90deg, #ff6b6b, #ffc6c6);
            transition: all 0.3s ease;
        }
        .btn-gradient:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
        }
        .selected-card {
            animation: pulse-border 2s infinite;
        }
        
        @keyframes pulse-border {
            0% {
                border-color: rgba(139, 92, 246, 0.3);
            }
            50% {
                border-color: rgba(139, 92, 246, 0.8);
            }
            100% {
                border-color: rgba(139, 92, 246, 0.3);
            }
        }
        .breathing-gradient {
            animation: breathing-gradient 3s ease-in-out infinite;
        }
        
        @keyframes breathing-gradient {
            0% {
                opacity: 0.3;
            }
            50% {
                opacity: 0.7;
            }
            100% {
                opacity: 0.3;
            }
        }
        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }
        .image-item {
            position: relative;
            overflow: hidden;
            border-radius: 0.5rem;
            transition: transform 0.3s ease;
        }
        .image-item:hover {
            transform: translateY(-5px);
        }
        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.3s ease;
        }
        .image-item:hover img {
            opacity: 0.9;
        }
        
        .loader-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .prompt-loader {
            width: 80px;
            height: 80px;
            position: relative;
            margin-bottom: 1.5rem;
        }
        .prompt-loader div {
            position: absolute;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(90deg, #8b5cf6, #ec4899);
            animation: prompt-loader 1.2s linear infinite;
        }
        .prompt-loader div:nth-child(1) {
            top: 8px;
            left: 8px;
            animation-delay: 0s;
        }
        .prompt-loader div:nth-child(2) {
            top: 8px;
            left: 32px;
            animation-delay: -0.4s;
        }
        .prompt-loader div:nth-child(3) {
            top: 8px;
            left: 56px;
            animation-delay: -0.8s;
        }
        .prompt-loader div:nth-child(4) {
            top: 32px;
            left: 8px;
            animation-delay: -0.4s;
        }
        .prompt-loader div:nth-child(5) {
            top: 32px;
            left: 32px;
            animation-delay: -0.8s;
        }
        .prompt-loader div:nth-child(6) {
            top: 32px;
            left: 56px;
            animation-delay: -1.2s;
        }
        .prompt-loader div:nth-child(7) {
            top: 56px;
            left: 8px;
            animation-delay: -0.8s;
        }
        .prompt-loader div:nth-child(8) {
            top: 56px;
            left: 32px;
            animation-delay: -1.2s;
        }
        .prompt-loader div:nth-child(9) {
            top: 56px;
            left: 56px;
            animation-delay: -1.6s;
        }
        @keyframes prompt-loader {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.5;
                transform: scale(0.8);
            }
        }
        
        .image-loader {
            width: 100px;
            height: 100px;
            position: relative;
            margin-bottom: 1.5rem;
        }
        .image-loader:before, .image-loader:after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid transparent;
        }
        .image-loader:before {
            border-top-color: #8b5cf6;
            border-right-color: #ec4899;
            animation: spin 1.5s linear infinite;
        }
        .image-loader:after {
            border-bottom-color: #8b5cf6;
            border-left-color: #ec4899;
            animation: spin 1s ease-in-out infinite reverse;
        }
        @keyframes spin {
            0% {
                transform: rotate(0deg) scale(1);
            }
            50% {
                transform: rotate(180deg) scale(1.1);
            }
            100% {
                transform: rotate(360deg) scale(1);
            }
        }
        
        .loading-text {
            font-weight: 500;
            background: linear-gradient(90deg, #8b5cf6, #ec4899, #8b5cf6);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: shine 2s linear infinite;
        }
        @keyframes shine {
            to {
                background-position: 200% center;
            }
        }
        #extractedImagesGrid img {
            transition: transform 0.2s ease-in-out;
        }
        #extractedImagesGrid img:hover {
            transform: scale(1.05);
        }
        .selected-image {
            border-color: #8B5CF6 !important;
            --tw-ring-color: #8B5CF6 !important;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 50;
            overflow: auto;
        }
        
        .modal-content {
            position: relative;
            margin: auto;
            padding: 20px;
            max-width: 90%;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .modal-content img {
            max-width: 100%;
            max-height: 75vh;
            object-fit: contain;
            margin-bottom: 20px;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-button {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .modal-submit {
            background: linear-gradient(to right, #8B5CF6, #EC4899);
            color: white;
        }

        .modal-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .modal-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            backdrop-filter: blur(4px);
        }

        .modal-cancel:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            color: #fff;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            z-index: 51;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close-modal:hover {
            background: rgba(0, 0, 0, 0.8);
            transform: scale(1.1);
        }
        
        #extractedImagesGrid img {
            cursor: zoom-in;
        }
    </style>
    <script src="{{ url_for('static', filename='js/scrape.do.js') }}"></script>
</head>
<body class="text-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="flex items-center mb-6">
            <a href="{{ url_for('welcome') }}" class="text-white text-sm hover:underline flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
                Ana Sayfa
            </a>
        </div>

        <header class="mb-12 text-center">
            <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-500 to-pink-500 mb-2">Hƒ±zlƒ± G√∂rsel √úretici</h1>
            <p class="text-gray-400 max-w-2xl mx-auto">Web sitesi URL'sini girin, yapay zeka sizin i√ßin √∂zel promptlar olu≈ütursun ve etkileyici g√∂rseller √ºretsin.</p>
        </header>

        <div class="max-w-6xl mx-auto bg-gray-800 rounded-xl shadow-2xl overflow-hidden">
            <div class="p-6">
                <form id="imageForm" class="mb-6">
                    <div class="mb-4">
                        <label for="brandInput" class="block text-gray-300 mb-2 font-medium">URL Girin</label>
                        <input type="url" id="brandInput" name="brand_input" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-100" placeholder="https://example.com" required>
                    </div>
                    
                    <button id="generateBtn" type="submit" class="w-full py-3 px-6 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-medium rounded-lg shadow-lg hover:from-purple-700 hover:to-pink-700 transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50">
                        G√∂rselleri Getir
                    </button>
                </form>

                <div id="extractedImagesContainer" class="mt-8 hidden">
                    <h3 class="text-xl font-semibold mb-4 text-purple-400">√áƒ±karƒ±lan G√∂rseller</h3>
                    <p class="mb-4 text-gray-300">L√ºtfen bir g√∂rsel se√ßin:</p>
                    <div id="extractedImagesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    </div>
                </div>

                <!-- Loading Animation -->
                <div id="loadingAnimation" class="hidden mt-8">
                    <div class="flex flex-col items-center justify-center p-8">
                        <div class="prompt-loader mb-4">
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                        </div>
                        <p class="text-lg font-medium text-purple-400">G√∂rseller Y√ºkleniyor...</p>
                        <p class="text-sm text-gray-400 mt-2">L√ºtfen bekleyin</p>
                    </div>
                </div>
            </div>
        </div>
        
        <footer class="mt-12 text-center text-gray-500 text-sm">
            <p>¬© 2025 Hƒ±zlƒ± G√∂rsel √úretici | AI Destekli G√∂rsel √úretim Aracƒ±</p>
        </footer>
    </div>

    <!-- Modal -->
    <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-4 rounded-lg max-w-4xl w-full mx-4 relative">
            <button onclick="closeModal()" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            <div class="mt-4">
                <img id="modalImage" src="" alt="Selected image" class="max-h-[80vh] mx-auto">
            </div>
            <div class="mt-4 flex justify-end space-x-2">
                <button onclick="closeModal()" class="modal-button modal-cancel">Vazge√ß</button>
                <button onclick="submitImageSelectionAndClose()" class="modal-button modal-submit">Bu G√∂rseli Se√ß</button>
            </div>
        </div>
    </div>

    <script>
        let currentImageContainer = null;

        document.addEventListener('DOMContentLoaded', function() {
            const images = document.querySelectorAll('.image-gallery img');
            images.forEach(img => {
                img.addEventListener('error', function() {
                    this.parentNode.innerHTML = `
                        <div class="flex items-center justify-center h-48 bg-gray-800 rounded-lg">
                            <p class="text-red-400 text-sm">G√∂rsel y√ºklenemedi</p>
                        </div>
                    `;
                });
            });
            
            const imageForm = document.getElementById('imageForm');
            const extractedImagesContainer = document.getElementById('extractedImagesContainer');
            const extractedImagesGrid = document.getElementById('extractedImagesGrid');
            
            imageForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const brandInput = document.getElementById('brandInput').value;
                if (!brandInput) {
                    alert('L√ºtfen ge√ßerli bir URL girin');
                    return;
                }

                // Store the input value in session storage
                sessionStorage.setItem('lastBrandInput', brandInput);
                
                // Refresh the page
                window.location.reload();
                return;
            });

            // Check for stored input value when page loads
            (async function() {
                const lastBrandInput = sessionStorage.getItem('lastBrandInput');
                if (lastBrandInput) {
                    // Clear the stored value
                    sessionStorage.removeItem('lastBrandInput');
                    
                    // Set the input value
                    document.getElementById('brandInput').value = lastBrandInput;
                    
                    try {
                        // Show loading animation
                        document.getElementById('loadingAnimation').classList.remove('hidden');
                        imageForm.classList.add('opacity-50', 'pointer-events-none');
                        
                        const extractResponse = await fetch('/extract-images', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ url: lastBrandInput })
                        });

                        const extractData = await extractResponse.json();
                        
                        if (extractData.error) {
                            throw new Error(extractData.error);
                        }

                        extractedImagesGrid.innerHTML = '';

                        if (extractData.product_images && extractData.product_images.length > 0) {
                            // Hide loading animation
                            document.getElementById('loadingAnimation').classList.add('hidden');
                            extractedImagesContainer.classList.remove('hidden');
                            
                            extractData.product_images.forEach((imageUrl, index) => {
                                const imageContainer = document.createElement('div');
                                imageContainer.className = 'relative border-2 border-transparent rounded-lg cursor-pointer hover:border-purple-500 transition-all';
                                imageContainer.setAttribute('data-url', imageUrl);
                                
                                const img = document.createElement('img');
                                img.src = imageUrl;
                                img.alt = `Extracted image ${index + 1}`;
                                img.className = 'w-full h-48 object-cover rounded-lg';
                                
                                const loadingOverlay = document.createElement('div');
                                loadingOverlay.className = 'absolute inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center';
                                loadingOverlay.innerHTML = '<div class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-purple-500"></div>';
                                imageContainer.appendChild(loadingOverlay);
                                
                                img.onload = function() {
                                    loadingOverlay.remove();
                                };
                                
                                img.onerror = function() {
                                    loadingOverlay.innerHTML = '<p class="text-red-400 text-sm">G√∂rsel y√ºklenemedi</p>';
                                };
                                
                                imageContainer.appendChild(img);
                                
                                imageContainer.addEventListener('click', function(e) {
                                    if (e.target.tagName === 'IMG') {
                                        const imageUrl = this.getAttribute('data-url');
                                        currentImageContainer = this;
                                        showModal(imageUrl);
                                        e.stopPropagation();
                                    }
                                });
                                
                                extractedImagesGrid.appendChild(imageContainer);
                            });
                        } else {
                            throw new Error('G√∂rsel bulunamadƒ±');
                        }
                    } catch (error) {
                        // Hide loading animation on error
                        document.getElementById('loadingAnimation').classList.add('hidden');
                        alert('Hata: ' + error.message);
                    } finally {
                        imageForm.classList.remove('opacity-50', 'pointer-events-none');
                    }
                }
            })();
        });

        function showModal(imageUrl) {
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            modalImg.src = imageUrl;
            modal.classList.remove('hidden');
        }

        function closeModal() {
            const modal = document.getElementById('imageModal');
            modal.classList.add('hidden');
        }

        async function checkGenerationStatus(requestId) {
            if (!requestId) return null;
            
            try {
                const response = await fetch(`/check_status/${requestId}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                console.log('Status check response:', data);
                return data;
            } catch (error) {
                console.error('Status check error:', error);
                return null;
            }
        }

        async function submitImageSelectionAndClose() {
            const modal = document.getElementById('imageModal');
            modal.classList.add('hidden');
            await submitImageSelection();
        }

        async function submitImageSelection() {
            if (!currentImageContainer) {
                console.warn('‚ö†Ô∏è G√∂rsel se√ßilmedi!');
                alert('L√ºtfen bir g√∂rsel se√ßin');
                return;
            }

            const selectedImageUrl = currentImageContainer.getAttribute('data-url');
            console.log('üñºÔ∏è Se√ßilen g√∂rsel:', selectedImageUrl);

            // Create a container for generated images if it doesn't exist
            let generatedImagesContainer = document.getElementById('generatedImagesContainer');
            if (!generatedImagesContainer) {
                generatedImagesContainer = document.createElement('div');
                generatedImagesContainer.id = 'generatedImagesContainer';
                generatedImagesContainer.className = 'mt-8';
                generatedImagesContainer.innerHTML = `
                    <h3 class="text-xl font-semibold mb-4 text-purple-400">√úretilen G√∂rseller</h3>
                    <div id="generatedImagesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4"></div>
                `;
                
                // Add the container after extractedImagesContainer
                const extractedImagesContainer = document.getElementById('extractedImagesContainer');
                extractedImagesContainer.parentNode.insertBefore(generatedImagesContainer, extractedImagesContainer.nextSibling);
            }

            const generatedImagesGrid = document.getElementById('generatedImagesGrid');
            generatedImagesGrid.innerHTML = ''; // Clear previous images

            try {
                // Add loading indicator for prompt generation
                const loadingPrompt = document.createElement('div');
                loadingPrompt.className = 'col-span-2 text-center p-4';
                loadingPrompt.innerHTML = `
                    <div class="flex flex-col items-center">
                        <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"></div>
                        <p class="text-gray-400 text-sm mt-4">Promptlar olu≈üturuluyor...</p>
                    </div>
                `;
                generatedImagesGrid.appendChild(loadingPrompt);

                // Generate prompts for the selected image - NOW this happens only after image selection
                const promptResponse = await fetch('/generate-prompt', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: selectedImageUrl,
                        feature_type: 'image'
                    })
                });

                const promptData = await promptResponse.json();
                if (promptData.error) {
                    throw new Error(promptData.error);
                }

                // Remove loading indicator
                loadingPrompt.remove();

                // Log prompts to console
                if (promptData.prompt_data && promptData.prompt_data.length > 0) {
                    console.log('\nüìù Se√ßilen G√∂rsel i√ßin Olu≈üturulan Promptlar:');
                    
                    // Create loading placeholders for all images
                    const loadingContainers = promptData.prompt_data.map((_, index) => {
                        const loadingContainer = document.createElement('div');
                        loadingContainer.className = 'relative border-2 border-transparent rounded-lg min-h-[300px] bg-gray-800 flex items-center justify-center';
                        loadingContainer.innerHTML = `
                            <div class="flex flex-col items-center">
                                <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"></div>
                                <p class="text-gray-400 text-sm mt-4">G√∂rsel ${index + 1} √ºretiliyor...</p>
                                <p class="text-gray-500 text-xs mt-2 status-text">Ba≈ülatƒ±lƒ±yor...</p>
                            </div>
                        `;
                        generatedImagesGrid.appendChild(loadingContainer);
                        return loadingContainer;
                    });
                    
                    try {
                        // Generate all images at once
                        const response = await fetch('/generate_image', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                prompt_data: promptData.prompt_data,
                                image_url: selectedImageUrl
                            })
                        });
                        
                        const imageData = await response.json();
                        
                        if (imageData.error) {
                            throw new Error(imageData.error);
                        }

                        console.log('‚úÖ Fal.ai\'den yanƒ±t alƒ±ndƒ±:', imageData);

                        if (imageData.generated_images && imageData.generated_images.length > 0) {
                            imageData.generated_images.forEach((genImage, index) => {
                                const loadingContainer = loadingContainers[index];
                                
                                // Create image container
                                const imageContainer = document.createElement('div');
                                imageContainer.className = 'relative border-2 border-transparent rounded-lg overflow-hidden cursor-pointer bg-gray-800';
                                
                                const img = document.createElement('img');
                                img.src = genImage.image_url;
                                img.alt = `Generated image ${index + 1}`;
                                img.className = 'w-full h-[300px] object-cover rounded-lg';
                                
                                // Add click event to container
                                imageContainer.addEventListener('click', () => {
                                    showImageModal(genImage.image_url, index + 1);
                                });

                                imageContainer.appendChild(img);
                                
                                // Replace loading placeholder with actual image container
                                loadingContainer.replaceWith(imageContainer);
                            });
                        }

                    } catch (error) {
                        console.error('‚ùå G√∂rsel √ºretme hatasƒ±:', error);
                        loadingContainers.forEach(container => {
                            container.innerHTML = `
                                <div class="text-red-400 text-center p-4">
                                    <p class="font-semibold mb-2">G√∂rsel √ºretilemedi</p>
                                    <p class="text-sm">${error.message}</p>
                                </div>
                            `;
                        });
                    }
                }

                // Close the modal
                closeModal();

                // Add selected class to the image container
                document.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
                currentImageContainer.classList.add('selected');

            } catch (error) {
                console.error('‚ùå Prompt olu≈üturma hatasƒ±:', error);
                alert('Prompt olu≈üturulurken bir hata olu≈ütu: ' + error.message);
            }
        }

        // Make functions globally available
        window.showModal = showModal;
        window.closeModal = closeModal;
        window.submitImageSelection = submitImageSelection;

        function showImageModal(imageUrl, imageIndex) {
            // Create modal container
            const modalContainer = document.createElement('div');
            modalContainer.className = 'fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-90 transition-opacity duration-300';
            modalContainer.style.opacity = '0';

            // Create modal content
            const modalContent = document.createElement('div');
            modalContent.className = 'relative max-w-4xl w-full bg-gray-900 rounded-lg shadow-xl transform transition-transform duration-300 scale-95';
            
            // Create close button
            const closeButton = document.createElement('button');
            closeButton.className = 'absolute top-4 right-4 text-gray-400 hover:text-white z-50 p-2 rounded-full bg-gray-800 hover:bg-gray-700 transition-colors duration-200';
            closeButton.innerHTML = `
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            `;
            closeButton.onclick = () => {
                modalContainer.style.opacity = '0';
                modalContent.classList.remove('scale-100');
                modalContent.classList.add('scale-95');
                setTimeout(() => modalContainer.remove(), 300);
            };

            // Create image container
            const imageContainer = document.createElement('div');
            imageContainer.className = 'p-4';
            
            const modalImage = document.createElement('img');
            modalImage.src = imageUrl;
            modalImage.alt = `Generated image ${imageIndex}`;
            modalImage.className = 'w-full max-h-[70vh] object-contain rounded-lg';

            // Create download button
            const downloadButton = document.createElement('button');
            downloadButton.className = 'mt-4 w-full bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg flex items-center justify-center space-x-2 transition-all duration-200 hover:scale-105';
            downloadButton.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
                <span>G√∂rseli ƒ∞ndir</span>
            `;
            
            downloadButton.onclick = async (e) => {
                e.preventDefault();
                e.stopPropagation();
                
                try {
                    const response = await fetch(imageUrl);
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `generated-image-${imageIndex}.png`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    console.log('‚úÖ G√∂rsel ba≈üarƒ±yla indirildi');
                } catch (error) {
                    console.error('‚ùå G√∂rsel indirme hatasƒ±:', error);
                    alert('G√∂rsel indirilirken bir hata olu≈ütu');
                }
            };

            // Add keyboard event listener for closing modal with Escape key
            const handleKeyDown = (e) => {
                if (e.key === 'Escape') {
                    closeButton.click();
                    document.removeEventListener('keydown', handleKeyDown);
                }
            };
            document.addEventListener('keydown', handleKeyDown);

            // Assemble modal
            imageContainer.appendChild(modalImage);
            imageContainer.appendChild(downloadButton);
            modalContent.appendChild(closeButton);
            modalContent.appendChild(imageContainer);
            modalContainer.appendChild(modalContent);
            document.body.appendChild(modalContainer);

            // Trigger animations
            requestAnimationFrame(() => {
                modalContainer.style.opacity = '1';
                modalContent.classList.remove('scale-95');
                modalContent.classList.add('scale-100');
            });
        }
    </script>
</body>
</html> 